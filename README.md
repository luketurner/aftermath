# aftermath

`aftermath` is a tool for post-processing HTML that was generated by an SSG tool like [Hugo](https://gohugo.io/). Its purpose is to "pre-render" some things that would otherwise be rendered with client-side Javascript, e.g. KaTeX equations.

Given a directory of HTML files, `aftermath` will apply the following transformations:

1. Replace `mermaid` code blocks with compiled SVGs.
2. Replace `KaTeX` syntax with compiled SVGs.

Although designed to work with HTML output by Hugo, in theory `aftermath` doesn't really care where the HTML came from, and could be used with the output from other SSGs (or even handwritten documents!)

> **Warning**
> 
> `aftermath` processes all the HTML using [Cheerio](https://github.com/cheeriojs/cheerio). This may result in some spurious transformation (e.g. changing whitespace or escaping) if the output format of Cheerio's `.html()` is different than the original HTML.

## Usage w/Docker

I run `aftermath` using Docker, because it has rather a lot of dependencies.

For the following usage instructions, assume that:

1. Your blog project's "root" is `.` (e.g. with Hugo, your `config.toml` is in `.`)
2. Your published HTML goes in `./public`

Then you can clone this repository into `./aftermath` and build a Docker image:

```bash
git submodule add https://github.com/luketurner/blog-aftermath.git aftermath
docker build aftermath -t aftermath
```

Then to run `aftermath`, you need to mount the `./public` directory to the `/home/aftermath/input` directory:

```bash
docker run --mount "type=bind,source=$(pwd)/public,target=/home/aftermath/input" aftermath
```

The above command will transform the HTML in your `./public` directory in-place. You can manually review the changes before committing them. Note the container _will not_ publish your HTML, it just transforms it.